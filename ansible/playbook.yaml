- hosts: all
  sudo: True

  tasks:
  - apt: update-cache=yes upgrade=yes

  - include: tasks/database.yaml
  - include: tasks/messaging.yaml
  - include: tasks/webinterface.yaml

  - apt: name={{ item }} state=latest
    with_items:
      - git
      - libmysqlclient-dev
      - python-dev
      - python-virtualenv

  - command: pip install -r /vagrant/requirements.txt
  - command: python setup.py install
    args:
      chdir: /vagrant

  - copy: src=files/{{ item }} dest=/home/vagrant/{{ item }} mode=0755 owner=vagrant group=vagrant
    with_items:
      - run_api.sh
      - run_producer.sh
      - run_worker.sh

  - copy: src=files/{{ item }} dest=/home/vagrant/{{ item }} mode=0644 owner=vagrant group=vagrant
    with_items:
      - producer.conf
      - worker.conf
